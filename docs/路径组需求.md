这是一个为 Antigravity（AI 编程助手）准备的需求文档。该文档严格遵循 NetBox 4.x 插件开发的最佳实践，并参照了你提供的 model\_description.md 中的格式，以确保上下文的一致性。

你可以直接将以下内容复制给 AI 助手。

# ---

**NetBox OTN 插件功能增强需求：路径组 (OtnPathGroup)**

## **一、 需求背景**

当前 OTN 故障管理插件中，OtnPath（光缆路径）是扁平化管理的。为了更好地管理大规模网络中的光缆资源（例如：按区域、按骨干/汇聚层级、或按项目分期归类），需要引入 **OtnPathGroup（路径组）** 模型。

本需求旨在创建 OtnPathGroup 模型，并将其与现有的 OtnPath 模型建立关联。

## ---

**二、 数据模型设计 (Data Models)**

### **2.1 新增模型：OtnPathGroup**

该模型需继承 NetBoxModel，以获得 NetBox 4.x 原生的标签、自定义字段、变更日志（ChangeLog）和日记（Journal/Log）功能。

| 字段名 (Field) | 类型 (Type) | 属性 (Attributes) | 说明 (Description) |
| :---- | :---- | :---- | :---- |
| name | CharField | max\_length=100, unique=True | **名称**。路径组的显示名称。 |
| slug | SlugField | max\_length=100, unique=True | **缩写/标识**。用于 URL 路由友好访问，通常由 name 自动生成。 |
| description | CharField | max\_length=200, blank=True | **描述**。简短的描述信息。 |
| comments | TextField | blank=True | **评论**。支持 Markdown 的详细备注。 |

**基类特性要求：**

* **Inheritance**: 必须继承 netbox.models.NetBoxModel。  
* **Features**:  
  * Tags (标签) \- 原生支持。  
  * Change Logging (变更日志) \- 原生支持。  
  * Journaling (日志/日记) \- 原生支持。

### **2.2 修改现有模型：OtnPath**

需要对现有的 OtnPath 模型进行迁移（Migration），增加与 OtnPathGroup 的外键关联。

| 字段名 | 类型 | 属性 | 说明 |
| :---- | :---- | :---- | :---- |
| group | ForeignKey | to=OtnPathGroup, on\_delete=SET\_NULL, null=True, blank=True, related\_name='paths' | **所属路径组**。一个路径组可以包含多条路径（One-to-Many）。 |

## ---

**三、 实体关系图 (ER Diagram)**

代码段

erDiagram  
    OtnPathGroup ||--o{ OtnPath : "包含 (One-to-Many)"  
      
    OtnPathGroup {  
        string name "名称"  
        string slug "缩写"  
        string description "描述"  
        string comments "评论"  
    }

    OtnPath {  
        string name "路径名称"  
        foreignKey group "关联路径组"  
    }

## ---

**四、 功能实现细节 (Implementation)**

### **4.1 后端逻辑 (Backend)**

1. **Filters (filtersets.py)**:  
   * 创建 OtnPathGroupFilterSet，继承 NetBoxModelFilterSet。  
   * 更新 OtnPathFilterSet，增加 group 和 group\_id 过滤字段，允许通过路径组筛选路径。  
2. **API (api/)**:  
   * **Serializers**: 创建 OtnPathGroupSerializer，继承 NetBoxModelSerializer。  
   * **ViewSets**: 创建 OtnPathGroupViewSet，继承 NetBoxModelViewSet。  
   * 更新 OtnPathSerializer，增加 group 字段的序列化（建议使用 NestedOtnPathGroupSerializer）。  
3. **Tables (tables.py)**:  
   * 创建 OtnPathGroupTable，继承 NetBoxTable。  
     * 列：Name, Description, Path Count (统计关联的路径数量), Actions。  
   * 更新 OtnPathTable，增加 group 列。  
4. **Forms (forms.py)**:  
   * 创建 OtnPathGroupForm，继承 NetBoxModelForm。  
   * 更新 OtnPathForm，增加 group 选择字段。

### **4.2 前端视图 (Views & Templates)**

遵循 NetBox 4.x 的视图规范，使用泛型视图（Generic Views）。

1. **Views (views.py)**:  
   * 实现 OtnPathGroupListView, OtnPathGroupEditView, OtnPathGroupDeleteView, OtnPathGroupView (Detail)。  
   * 在 OtnPathGroupView (详情页) 中，增加一个 Tab 或面板，列出属于该组的所有 **OtnPath**。  
2. **Templates**:  
   * 创建标准的 CRUD 模板。  
   * 详情页 (otnpathgroup.html) 需展示基本信息及关联的路径列表表哥（Table）。  
3. **Navigation (navigation.py)**:  
   * 在 "路径管理" (Path Management) 菜单项下，新增 "路径组" (Path Groups) 菜单。

## ---

**五、 验收标准 (Acceptance Criteria)**

1. **数据库迁移**：能够成功执行 makemigrations 和 migrate，并在数据库中生成新表及外键字段。  
2. **CRUD 操作**：能够在 NetBox UI 中创建、读取、更新、删除路径组。  
3. **关联功能**：  
   * 创建/编辑 OtnPath 时，可以选择所属的 OtnPathGroup。  
   * 在 OtnPathGroup 的详情页，可以看到所有关联的 OtnPath 列表。  
4. **API 验证**：  
   * GET /api/plugins/otn-faults/path-groups/ 返回路径组列表。  
   * GET /api/plugins/otn-faults/paths/?group=xxx 能够正确筛选路径。  
5. **核心字段完整性**：名称、缩写、描述、评论、标签、日志功能均正常工作。

## ---

**六、 参考代码片段 (Reference Snippets)**

**模型定义参考 (models.py):**

Python

from django.db import models  
from netbox.models import NetBoxModel  
from django.utils.translation import gettext\_lazy as \_

class OtnPathGroup(NetBoxModel):  
    name \= models.CharField(  
        verbose\_name=\_('name'),  
        max\_length=100,  
        unique=True  
    )  
    slug \= models.SlugField(  
        verbose\_name=\_('slug'),  
        max\_length=100,  
        unique=True  
    )  
    description \= models.CharField(  
        verbose\_name=\_('description'),  
        max\_length=200,  
        blank=True  
    )  
    comments \= models.TextField(  
        verbose\_name=\_('comments'),  
        blank=True  
    )

    class Meta:  
        ordering \= ('name',)  
        verbose\_name \= \_('path group')  
        verbose\_name\_plural \= \_('path groups')

    def \_\_str\_\_(self):  
        return self.name

\# 在 OtnPath 模型中添加:  
\# group \= models.ForeignKey(  
\#     to='otn\_faults.OtnPathGroup',  
\#     on\_delete=models.SET\_NULL,  
\#     related\_name='paths',  
\#     blank=True,  
\#     null=True,  
\#     verbose\_name=\_('path group')  
\# )

**来源**  
1\. [https://github.com/netbox-community/netbox](https://github.com/netbox-community/netbox)