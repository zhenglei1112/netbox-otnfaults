# NetBox OTN 故障管理插件演示说明

## 一、插件概述

### 1.1 项目定位

NetBox OTN 故障管理插件是专为光纤传输网络（OTN）设计的故障登记与影响分析系统。该插件基于 NetBox 4.4.2 版本开发，为网络运维团队提供全中文界面的故障全生命周期管理能力。

### 1.2 核心价值

- **统一故障管理**：集中登记、跟踪和分析光纤网络故障
- **业务影响评估**：关联故障与受影响的租户业务，量化中断时长
- **可视化分析**：通过交互式地图展示故障地理分布
- **自动化计算**：自动生成故障编号、计算故障历时和修复用时

---

## 二、功能模块详解

### 2.1 故障登记模块

#### 核心功能

故障登记是整个系统的核心，用于记录 OTN 网络中发生的各类故障事件。

#### 故障基本信息

| 字段名称     | 类型     | 说明                                                                     |
| ------------ | -------- | ------------------------------------------------------------------------ |
| 故障编号     | 文本     | 系统自动生成，格式为 FYYYYMMDDNNN（如 F20241222001）                     |
| 值守人员     | 选择     | 登记故障的当班人员，引用系统用户                                         |
| 故障中断时间 | 日期时间 | 故障发生的具体时间                                                       |
| 故障恢复时间 | 日期时间 | 故障恢复的时间                                                           |
| 故障历时     | 自动计算 | 自动计算中断与恢复的时间差，格式如"0 天 2 小时 30 分 15 秒（2.50 小时）" |

#### 故障位置信息

| 字段名称 | 类型 | 说明                                 |
| -------- | ---- | ------------------------------------ |
| A 端站点 | 选择 | 故障位置的起始站点，引用 NetBox 站点 |
| Z 端站点 | 多选 | 故障位置的终止站点，支持多个站点     |
| 省份     | 选择 | 故障所属地区，引用 NetBox 地区       |
| 故障经度 | 数值 | GPS 坐标（十进制格式, xx.yyyyyy）    |
| 故障纬度 | 数值 | GPS 坐标（十进制格式, xx.yyyyyy）    |

#### 故障分类选项

**故障分类**（按严重程度颜色标识）：

- 🔴 **光缆故障** - 光纤物理中断
- 🟠 **电力故障** - 电源供应问题
- 🔵 **空调故障** - 机房环境问题
- 🟢 **设备故障** - 网络设备问题
- ⚫ **其他故障** - 其他类型

**紧急程度**（使用颜色区分）：

- 🔴 **高** - 需立即处理
- 🟠 **中** - 需优先处理
- 🟡 **低** - 常规处理

**处理状态**：

- 🔴 **处理中** - 故障正在修复
- 🔵 **临时恢复** - 临时解决方案已实施
- 🟡 **挂起** - 等待条件处理
- 🟢 **已关闭** - 故障已完结

#### 故障原因分类

系统预设了常见的故障原因选项：

- 道路施工
- 人为破坏
- 线路整改
- 误操作
- 供电故障
- 市政施工
- 鼠害
- 自然灾害

#### 维护管理信息

| 字段名称     | 类型 | 说明                                        |
| ------------ | ---- | ------------------------------------------- |
| 第一报障来源 | 选择 | 国干网网管/未来网络网管/客户报障/其他       |
| 线路主管     | 选择 | 负责该线路的主管人员                        |
| 维护方式     | 选择 | 代维（蓝色）/协调（绿色）/自维（紫色）      |
| 处理单位     | 选择 | 引用服务提供商（来自 netbox-contract 插件） |
| 代维合同     | 选择 | 关联的维护合同（来自 netbox-contract 插件） |
| 故障处理人   | 文本 | 实际处理故障的人员姓名                      |

#### 时间线追踪

系统提供完整的故障处理时间线记录：

1. **处理派发时间** - 故障工单分配时间
2. **维修出发时间** - 维修人员出发时间
3. **到达现场时间** - 维修人员抵达现场时间
4. **故障修复时间** - 故障实际修复完成时间
5. **修复用时** - 自动计算（修复时间 - 派发时间）

系统会自动验证这些时间的逻辑顺序，确保数据准确性。

#### 资源与路由属性

| 字段名称     | 选项                                                             |
| ------------ | ---------------------------------------------------------------- |
| 资源类型     | 自建光缆（绿色）/协调资源（蓝色）/租赁纤芯（紫色）               |
| 光缆路由属性 | 高速公路（绿色）/非高速（橙色）                                  |
| 光缆中断部位 | 尾纤（黄色）/出局缆（橙色）/长途光缆（红色）                     |
| 恢复方式     | 熔接恢复/更换尾纤恢复/处理恢复/调纤恢复/自动恢复/无法查明/未提供 |

#### 附加功能

- **故障详情** - 记录故障详细描述和处理过程
- **图片附件** - 支持上传现场照片
- **超时管理** - 记录是否在规定时间内完成修复及超时原因
- **标签系统** - 支持自定义标签分类
- **评论系统** - 支持添加处理备注

---

### 2.2 故障影响业务模块

#### 模块说明

该模块用于记录故障对具体业务的影响，建立故障与客户业务之间的关联关系。

#### 数据模型

| 字段名称     | 类型     | 说明                                      |
| ------------ | -------- | ----------------------------------------- |
| 关联故障     | 选择     | 关联的故障记录                            |
| 影响业务     | 选择     | 受影响的租户/客户业务（引用 NetBox 租户） |
| 业务故障时间 | 日期时间 | 业务开始受影响的时间                      |
| 业务恢复时间 | 日期时间 | 业务恢复正常的时间                        |
| 业务中断历时 | 自动计算 | 自动计算中断时长                          |

#### 业务规则

- 一个故障可以影响多个业务（一对多关系）
- 同一故障不能重复关联同一个业务
- 业务级别的中断时间可能与故障时间不同（业务可能在故障恢复后才完全恢复）

---

### 2.3 路径管理模块

#### 模块说明

管理 OTN 光缆路径信息，包括路径的空间地理数据，用于故障定位和地图展示。

#### 数据模型

| 字段名称     | 类型 | 说明                              |
| ------------ | ---- | --------------------------------- |
| 名称         | 文本 | 路径名称标识                      |
| 光缆类型     | 选择 | 96 芯（蓝色）/144 芯（绿色）      |
| A 端站点     | 选择 | 路径起始站点                      |
| Z 端站点     | 选择 | 路径终止站点                      |
| 空间几何数据 | JSON | GeoJSON LineString 格式的坐标数组 |
| 计算长度     | 数值 | 路径长度（单位：米）              |
| 描述         | 文本 | 路径详细描述                      |

#### 与故障的关联

- 故障定位使用 A 端和 Z 端站点匹配对应的光缆路径
- 支持双向匹配（A-Z 或 Z-A 方向）
- 地图上可以高亮显示故障所在的路径

---

### 2.4 故障分布图模块

#### 概述

故障分布图是一个基于 MapLibre GL 的交互式地理可视化界面，展示故障的空间分布和统计分析。

#### 地图功能

**基础功能**：

- 故障点标记，按状态颜色区分（处理中为红色、临时恢复为蓝色、挂起为黄色、已关闭为绿色）
- 站点显示，展示所有 OTN 站点位置
- 光缆路径显示，展示完整的光缆网络拓扑
- 热力图模式，展示故障密度分布

**图层控制**：

- 视图模式切换（故障点/热力图）
- 时间范围筛选
- 故障状态筛选

**统计面板**：

- 故障总数统计
- 故障站点 Top5 排名
- 故障路径 Top5 排名
- 按时间的故障趋势图
- 按月份的故障分布图

**交互功能**：

- 点击故障点显示详细信息弹窗
- 弹窗中展示故障图片缩略图
- 弹窗中展示业务影响列表（业务名称和中断时长）
- 搜索站点/路径并快速定位
- 点击 Top5 条目可定位到对应位置

**地图配置**：

- 支持网络底图（Stadia Maps）和本地底图（PMTiles）
- 可配置地图中心点和默认缩放级别
- 支持中文地名显示

---

## 三、技术架构

### 3.1 系统集成

- **NetBox 集成**：作为 NetBox 插件无缝集成，共享用户认证和权限系统
- **netbox-contract 集成**：与合同管理插件联动，关联代维合同和服务提供商
- **Django 框架**：基于 Django ORM 和视图系统

### 3.2 前端技术

- **MapLibre GL JS**：开源地图渲染引擎
- **PMTiles**：支持本地矢量地图瓦片
- **模块化 JavaScript**：分层的控件和服务架构

### 3.3 API 支持

插件提供完整的 REST API 接口，支持：

- 故障数据的 CRUD 操作
- 故障影响业务的管理
- 路径数据的查询

---

## 四、用户界面

### 4.1 导航菜单

在 NetBox 导航栏中，OTN 故障管理插件提供以下入口：

1. **故障登记** - 故障列表和管理
2. **故障影响业务** - 业务影响记录管理
3. **路径管理** - 光缆路径管理
4. **故障分布图** - 交互式可视化地图

### 4.2 列表页面功能

- 多条件筛选过滤
- 批量导入（CSV 格式）
- 批量编辑
- 批量删除
- 数据导出

### 4.3 详情页面功能

- 故障完整信息展示
- 关联业务影响记录列表
- 图片附件查看
- 快速编辑入口

---

## 五、典型工作流程

### 5.1 故障登记流程

1. **接收故障报警** - 从网管系统或客户获取故障信息
2. **创建故障记录** - 填写故障基本信息、位置、分类
3. **派发处理工单** - 记录派发时间、指定处理单位
4. **跟踪处理进度** - 更新出发时间、到达时间等关键节点
5. **记录恢复情况** - 填写恢复时间、恢复方式
6. **关联业务影响** - 添加受影响的业务记录
7. **关闭故障工单** - 更新状态为已关闭

### 5.2 故障分析流程

1. **打开故障分布图** - 进入可视化界面
2. **设置时间范围** - 筛选分析周期
3. **查看统计数据** - 分析故障分布规律
4. **识别高发区域** - 通过 Top5 和热力图定位问题区域
5. **输出分析报告** - 为运维决策提供数据支持

---

## 六、演示要点

### PPT 演示建议

**第一页：项目介绍**

- 介绍 NetBox OTN 故障管理插件的定位和价值
- 强调全中文界面特性

**第二页：核心功能概览**

- 展示四大功能模块架构图
- 突出故障-业务影响的关联关系

**第三页：故障登记演示**

- 展示故障录入表单
- 说明自动编号和时间计算功能
- 演示多种分类选项

**第四页：数据关联**

- 展示故障与业务影响的一对多关系
- 演示中断时长自动计算

**第五页：可视化地图**

- 展示故障分布图界面
- 演示图层切换和筛选功能
- 展示统计面板和 Top5 排名

**第六页：地图交互**

- 演示点击故障点查看详情
- 展示搜索和定位功能
- 演示热力图分析

**第七页：技术优势**

- 与 NetBox 无缝集成
- 完善的权限控制
- 丰富的 API 接口

**第八页：应用价值**

- 提高故障响应效率
- 量化业务影响
- 支持运维决策
