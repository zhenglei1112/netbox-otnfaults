{% extends 'base/layout.html' %}
{% load static %}

{% block title %}故障分布图{% endblock %}

{% block content %}
<div class="row mb-3">
  <div class="col">
    <div class="card">
      <h5 class="card-header">
        故障分布图
        <div class="card-actions">
          <a
            href="{% url 'plugins:netbox_otnfaults:otnfault_list' %}"
            class="btn btn-ghost-primary btn-sm"
          >
            <i class="mdi mdi-format-list-bulleted"></i> 查看列表
          </a>
        </div>
      </h5>
      <div class="card-body p-0">
        <div id="map" style="height: calc(-178px + 100vh); width: 100%"></div>
      </div>
    </div>
  </div>
</div>

<link
  href="{% static 'netbox_otnfaults/lib/maplibre-gl.css' %}"
  rel="stylesheet"
/>
<script src="{% static 'netbox_otnfaults/lib/maplibre-gl.js' %}"></script>

<link
  rel="stylesheet"
  href="{% static 'netbox_otnfaults/css/otnfault_map_globe.css' %}"
/>

<script>
  window.OTNFaultMapConfig = {
      heatmapData: {{ heatmap_data| safe }},
      markerData: {{ marker_data| safe }},
      sitesData: {{ sites_data| safe }},
      apiKey: "{{ apikey }}",
      faultListUrl: "{% url 'plugins:netbox_otnfaults:otnfault_list' %}"
  };
</script>

<!-- Base -->
<script src="{% static 'netbox_otnfaults/js/maplibregl_base.js' %}"></script>

<!-- Utils -->
<script src="{% static 'netbox_otnfaults/js/utils/api.js' %}"></script>

<!-- Controls -->
<script src="{% static 'netbox_otnfaults/js/controls/LayerToggleControl.js' %}"></script>
<script src="{% static 'netbox_otnfaults/js/controls/CategoryFilterControl.js' %}"></script>
<script src="{% static 'netbox_otnfaults/js/controls/FaultStatisticsControl.js' %}"></script>
<script src="{% static 'netbox_otnfaults/js/controls/FaultLegendControl.js' %}"></script>
<script src="{% static 'netbox_otnfaults/js/controls/SearchControl.js' %}"></script>

<!-- App (Main) -->
<script src="{% static 'netbox_otnfaults/js/otnfault_map_app.js' %}?v=9"></script>
{% endblock %}
